"use strict";!function(t){const e=5.960464477539063e-8,n=4294967296,r=9007199254740992;t.CBOR={encode:function(t){let e,o=new ArrayBuffer(256),i=new DataView(o),s=0;function u(t){let n=o.byteLength;const r=s+t;for(;n<r;)n<<=1;if(n!==o.byteLength){const t=i;o=new ArrayBuffer(n),i=new DataView(o);const e=s+3>>2;for(let n=0;n<e;++n)i.setUint32(n<<2,t.getUint32(n<<2))}return e=t,i}function c(){s+=e}function f(t){c(u(1).setUint8(s,t))}function a(t){const e=u(t.length);for(let n=0;n<t.length;++n)e.setUint8(s+n,t[n]);c()}function l(t,e){e<24?f(t<<5|e):e<256?(f(t<<5|24),f(e)):e<65536?(f(t<<5|25),function(t){c(u(2).setUint16(s,t))}(e)):e<4294967296?(f(t<<5|26),function(t){c(u(4).setUint32(s,t))}(e)):(f(t<<5|27),function(t){const e=t%n,r=(t-e)/n,o=u(8);o.setUint32(s,r),o.setUint32(s+4,e),c()}(e))}if(function t(e){let n;if(!1===e)return f(244);if(!0===e)return f(245);if(null===e)return f(246);if(void 0===e)return f(247);switch(typeof e){case"number":if(Math.floor(e)===e){if(0<=e&&e<=r)return l(0,e);if(-r<=e&&e<0)return l(1,-(e+1))}return f(251),function(t){c(u(8).setFloat64(s,t))}(e);case"string":const o=[];for(n=0;n<e.length;++n){let t=e.charCodeAt(n);t<128?o.push(t):t<2048?(o.push(192|t>>6),o.push(128|63&t)):t<55296?(o.push(224|t>>12),o.push(128|t>>6&63),o.push(128|63&t)):(t=(1023&t)<<10,t|=1023&e.charCodeAt(++n),t+=65536,o.push(240|t>>18),o.push(128|t>>12&63),o.push(128|t>>6&63),o.push(128|63&t))}return l(3,o.length),a(o);default:let i;if(Array.isArray(e))for(i=e.length,l(4,i),n=0;n<i;++n)t(e[n]);else if(e instanceof Uint8Array)l(2,e.length),a(e);else{const r=Object.keys(e);for(i=r.length,l(5,i),n=0;n<i;++n){const o=r[n];t(o),t(e[o])}}}}(t),"slice"in o)return o.slice(0,s);const h=new ArrayBuffer(s),d=new DataView(h);for(let t=0;t<s;++t)d.setUint8(t,i.getUint8(t));return h},decode:function(t,r,o){const i=new DataView(t);let s=0;function u(t,e){return s+=t,e}function c(e){return u(e,new Uint8Array(t,s,e))}function f(){return u(1,i.getUint8(s))}function a(){return u(2,i.getUint16(s))}function l(){return u(4,i.getUint32(s))}function h(){return 255===i.getUint8(s)&&(s+=1,!0)}function d(t){if(t<24)return t;if(24===t)return f();if(25===t)return a();if(26===t)return l();if(27===t)return l()*n+l();if(31===t)return-1;throw"Invalid length encoding"}function w(t){const e=f();if(255===e)return-1;const n=d(31&e);if(n<0||e>>5!==t)throw"Invalid indefinite length element";return n}function g(t,e){for(let n=0;n<e;++n){let n=f();128&n&&(n<224?(n=(31&n)<<6|63&f(),e-=1):n<240?(n=(15&n)<<12|(63&f())<<6|63&f(),e-=2):(n=(15&n)<<18|(63&f())<<12|(63&f())<<6|63&f(),e-=3)),n<65536?t.push(n):(n-=65536,t.push(55296|n>>10),t.push(56320|1023&n))}}"function"!=typeof r&&(r=function(t){return t}),"function"!=typeof o&&(o=function(){});const p=function t(){const n=f(),l=n>>5,p=31&n;let y,b;if(7===l)switch(p){case 25:return function(){const t=new ArrayBuffer(4),n=new DataView(t),r=a(),o=32768&r;let i=31744&r;const s=1023&r;if(31744===i)i=261120;else if(0!==i)i+=114688;else if(0!==s)return(o?-1:1)*s*e;return n.setUint32(0,o<<16|i<<13|s<<13),n.getFloat32(0)}();case 26:return u(4,i.getFloat32(s));case 27:return u(8,i.getFloat64(s))}if(b=d(p),b<0&&(l<2||6<l))throw"Invalid length";switch(l){case 0:return b;case 1:return-1-b;case 2:if(b<0){const t=[];let e=0;for(;(b=w(l))>=0;)e+=b,t.push(c(b));const n=new Uint8Array(e);let r=0;for(y=0;y<t.length;++y)n.set(t[y],r),r+=t[y].length;return n}return c(b);case 3:const e=[];if(b<0)for(;(b=w(l))>=0;)g(e,b);else g(e,b);return String.fromCharCode.apply(null,e);case 4:let n;if(b<0)for(n=[];!h();)n.push(t());else for(n=new Array(b),y=0;y<b;++y)n[y]=t();return n;case 5:const i={};for(y=0;y<b||b<0&&!h();++y){i[t()]=t()}return i;case 6:return r(t(),b);case 7:switch(b){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;default:return o(b)}}}();if(s!==t.byteLength)throw"Remaining bytes";return p}}}(window);export const NetworkTables=new function(){let t,e,n,r;if(!("WebSocket"in window))return void alert("Your browser does not support websockets, this will fail!");this.create_map=function(){return new Map},this.keyToId=encodeURIComponent,this.keySelector=function(t){return encodeURIComponent(t).replace(/([;&,.+*~':"!^#$%@\[\]()=>|])/g,"\\$1")};const o=new Set,i=new Set,s=new Set,u=new Map;let c=new Map;this.addWsConnectionListener=function(t,e){return o.add(t),!0===e&&t(n),()=>o.delete(t)},this.addRobotConnectionListener=function(t,n){return i.add(t),!0===n&&t(e),()=>i.delete(t)},this.addGlobalListener=function(t,e){return s.add(t),!0===e&&c.forEach((function(e,n){t(n,e,!0)})),()=>s.delete(t)},this.addKeyListener=function(t,e,n){const r=u.get(t);if(void 0===r?u.set(t,new Set([e])):r.add(e),!0===n){const n=c.get(t);void 0!==n&&e(t,n,!0)}return()=>u.get(t).delete(e)},this.containsKey=function(t){return c.has(t)},this.getKeys=function(){return c.keys()},this.getValue=function(t,e){const n=c.get(t);return void 0===n?e:n},this.getRobotAddress=function(){return t},this.isRobotConnected=function(){return e},this.isWsConnected=function(){return n},this.closeSocket=function(){r&&r.close()},this.putValue=function(t,e){if(!n)return!1;if(void 0===e)throw new Error(t+": 'undefined' passed to putValue");return r.send(CBOR.encode({k:t,v:e})),!0},this.connect=function(t){if(!n)return!1;if("string"!=typeof t)throw new Error("address should be type 'string'");return c=new Map,r.send(CBOR.encode({a:t})),!0},this.setValue=this.putValue,n=!1,e=!1,t=null;const f=window.location,a=document.querySelector("[data-nt-host]"),l=`ws://${a?a.getAttribute("data-nt-host"):f.host}/networktables/ws`;!function f(){r=new WebSocket(l),r&&(r.binaryType="arraybuffer",r.onopen=function(){console.info("Socket opened"),n=!0,o.forEach((t=>t(!0)))},r.onmessage=function(n){const r=CBOR.decode(n.data);if(void 0!==r.r)e=r.r,t=r.a,i.forEach((t=>t(e)));else{const t=r.k,e=r.v,n=r.n;c.set(t,e),s.forEach((r=>r(t,e,n)));const o=u.get(t);void 0!==o&&o.forEach((r=>r(t,e,n)))}},r.onclose=function(){n&&(o.forEach((t=>t(!1))),i.forEach((t=>t(!1))),c=new Map,n=!1,e=!1,t=null,console.info("Socket closed")),setTimeout(f,300)})}()};
